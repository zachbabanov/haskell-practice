# Patience sort
  Итак, возьмём из колоды черви. Они будут изображать массив из тринадцати случайных элементов.  
  
  ![](https://habrastorage.org/webt/j_/ik/zg/j_ikzgnokw8bkhj9_frik-mai_e.png)
  
  Нам нужно разложить карты в несколько стопок, таким образом, чтобы в каждой стопке карты представляли из себя упорядоченную последовательность.  
  Другими словами, наша задача на этом этапе — из имеющегося неотсортированного массива быстро создать несколько упорядоченных подмассивов. При этом крайне желательно, чтобы количество   этих подмассивов были поменьше, а значит нужно стремиться к тому, чтобы подмассивы были подлиннее. Делается это следующим образом.
  
  Первая карта — начало первой стопки.
  
  ![](https://habrastorage.org/webt/d9/sp/bn/d9spbncxz30rhzxqrzfvywhhm6k.png)
  
  В эту стопку перекладываем карты по очереди, до тех пор, пока очередная перекладываемая карта меньше чем верхняя в стопке.  
  При этом каждая стопка является стеком — мы работаем не со всей стопкой, а только с верхней картой в ней, которую положили последней.  
  
  ![](https://habrastorage.org/webt/gf/gd/q-/gfgdq-oqzknwkou2dbcncafersa.png)
  
  Если текущая карта больше чем минимальная в стопке, значит, придётся создавать новую кучку, текущая карта открывает новую стопку.
  
  ![](https://habrastorage.org/webt/ab/97/z3/ab97z3z2dfaobk9tqveawpybhis.png)
  
  Очерёдность стопок важна! Если их количество уже более одного, то очередную карту мы кладём не в последнюю стопку, а в самую левую стопку, в которую можем положить.  
  
  Вот сейчас после дамы надо куда-то пристроить девятку. Механически хочется положить карту во вторую стопку, но в первой стопке верхняя карта больше девятки. Значит, можем продолжить   первую стопку, не нарушив её упорядоченность. Следующую тройку, которая идёт следом за девяткой, тоже кстати, отправляется в первую стопку.
  
  ![](https://habrastorage.org/webt/-4/ww/it/-4wwit3yrqc3gjywezucwhyh9lo.png)
  
  Семёрку и шестёрку в первую стопку добавить нельзя (они больше верхней карты в ней), но во второй стопке им пока находится место.
  
  ![](https://habrastorage.org/webt/zp/su/yc/zpsuycgew4jezzv44p3axcytg_i.png)
  
  Туз начинает новую стопку. Оставшаяся мелочь попадает в разные лотки, в зависимости от того, насколько левее была стопка, куда можно было вставить.
  
  ![](https://habrastorage.org/webt/uw/qw/r6/uwqwr6gzjdpdyogbzcts-whxoae.png)
  
  В итоге карты разложены в несколько стопок. В каждой стопке карты представляют из себя убывающую последовательность, вверху — наименьшая карта. Стопки являются стеками.  
  
  Так как мы старались сначала заполнять те стопки, что находились левее, у нас образовалось наименьшее возможно количество. Если бы мы просто прошлись по массиву и выделяли из него     убывающие подмассивы, то кучек, естественно будет полчаться намного больше.
  
  Сдвинем доступные верхние карты немного вниз, чтобы они встали в отдельный ряд. Если стопки являются стеками, то с нижним рядом будем работать как с очередью.
  
  ![](https://habrastorage.org/webt/-p/wo/sl/-pwosl95hk_iiqivtdkoypbk0oc.png)
  
  Что немаловажно — доступные верхние карты в стопках также представляют из себя упорядоченную последовательность. Нижний ряд уже отсортирован по возрастанию. Что и немудрено — при       формировании стопок карты поменьше отправлялись как можно левее.

  В дальнейшем до конца сортировки нас интересуют не все карты из тех что разложены на столе. Нужны только вот эти:
  * Самая левая карта (назовём её — текущая) в нижнем ряду-очереди.  
  * В стопках-стеках работаем только с верхними доступными картами. При этом нужны только те стопки, которые находятся непосредственно на текущей картой и левее. Стопки которые             находятся правее в этот момент не нужны.  
  В нижнем ряду перебираем карты слева-направо карты. Самая лева — текущий минимум, его возвращаем в первоначальный верхний ряд. При этом каждый раз, когда мы вернули на базу очередную   карту, необходимо на её место положить другую.  
  Откуда её взять? Из тех стопок что находятся над текущей картой и левее её — среди доступных карт выбирается минимум, который             перемещается на вакантное место текущей       левой карты в нижнем ряду, а оттуда — в основной массив.

  Двойка в массив возвращается сразу. Освободившееся место занимает тройка (перемещаем её из первой стопки в нижний ряд), а из нижнего ряда тройка как текущий минимум уходит в основной   массив. В первых двух стопках ищется снова минимум — это четвёрка — которая тоже отправляется домой. Текущим минимумом становится пятёрка и т.д.
  
  ![](https://habrastorage.org/webt/gi/ej/3x/giej3x5chmm4aggloxtewxvutem.png)  
  
